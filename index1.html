<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Interactive Sentence Generator - Enhanced</title>
    <!-- p5.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.2/lib/p5.min.js"></script>
    <!-- Tracery Library CDN -->
    <script src="https://cdn.jsdelivr.net/npm/tracery-grammar@1.1.1/dist/tracery.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Roboto', sans-serif;
        }
        .info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            width: 300px;
            transition: all 0.3s ease;
        }
        .info p {
            margin: 0;
            color: #333;
            font-size: 16px;
        }
        .info:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }

        .info p:first-child {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="info">
        <p>Click anywhere in the canvas to generate a random sentence.</p>
        <p>The sentence will fall down, bounce, and fade out with a dynamic background!</p>
    </div>

    <script>
        // Load Tracery grammar
        const grammar = {
          "origin": ["#noun.Tops# #verb.cognition# #noun.object#."],
          "noun": {
            "Tops": ["The bird", "The raven", "A squirrel", "A lion"],
            "object": ["nest", "tree", "rock", "lake"]
          },
          "verb": {
            "cognition": ["understood", "saw", "observed", "watched"]
          }
        };

        // Create Tracery grammar object
        const traceryGrammar = tracery.createGrammar(grammar);
        traceryGrammar.addModifiers(tracery.baseEngModifiers);

        let sentences = []; // Array to store active sentences
        let bgColorStart, bgColorEnd, bgColorLerp;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            textAlign(CENTER, CENTER);
            bgColorStart = generateWebSafeColor();
            bgColorEnd = generateWebSafeColor();
            bgColorLerp = 0;
        }

        function draw() {
            // Gradually change the background color
            bgColorLerp += 0.001;
            let bgColor = lerpColor(bgColorStart, bgColorEnd, bgColorLerp);
            background(bgColor);

            // Update and draw active sentences
            for (let i = sentences.length - 1; i >= 0; i--) {
                let sentence = sentences[i];
                push();
                fill(30, 30, 30, sentence.alpha);
                textSize(sentence.fontSize);

                // Make the text fall
                sentence.yPos += sentence.fallSpeed;

                // Add bounce effect
                if (sentence.yPos > height / 2) {
                    sentence.fallSpeed = -2;
                    sentence.bounceSpeed += 0.2;
                }

                // Bounce the text and gradually fade out
                if (sentence.bounceSpeed > 0) {
                    sentence.yPos -= sentence.bounceSpeed;
                    sentence.bounceSpeed -= 0.2;
                }

                // Draw the sentence at the new position
                text(sentence.text, sentence.xPos, sentence.yPos);

                // Fade out the text
                sentence.alpha -= 1.8;
                if (sentence.alpha <= 0) {
                    sentences.splice(i, 1); // Remove sentence when fully faded
                }

                pop();
            }
        }

        function mousePressed() {
            // Generate a random sentence using the Tracery grammar
            let sentenceText = traceryGrammar.flatten("#origin#");
            let newSentence = {
                text: sentenceText,
                xPos: mouseX,
                yPos: mouseY,
                alpha: 255,
                fallSpeed: 2,
                bounceSpeed: 0,
                fontSize: 36
            };

            // Add new sentence to the array
            sentences.push(newSentence);

            // Change background colors when the sentence is clicked
            bgColorStart = bgColorEnd;
            bgColorEnd = generateWebSafeColor();
            bgColorLerp = 0;
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }

        function generateWebSafeColor() {
            const webSafeColors = ['00', '33', '66', '99', 'CC', 'FF'];
            const red = random(webSafeColors);
            const green = random(webSafeColors);
            const blue = random(webSafeColors);
            return color(`#${red}${green}${blue}`);
        }
    </script>
</body>
</html>
